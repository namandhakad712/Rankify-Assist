# ğŸ¤– INSTRUCTIONS FOR AI ASSISTANTS

**IF YOU ARE AN AI ASSISTANT WORKING ON THIS CODEBASE, READ THIS FIRST!**

---

## âš ï¸ CRITICAL ARCHITECTURE RULE

This project uses **UPDATE-PROOF MODULE ARCHITECTURE**.

### ğŸ”’ THE GOLDEN RULE:

**NEVER** modify files in `c:\TUYA\nanobrowser/`

**ALWAYS** create files in `c:\TUYA\RankifyAssist\nanobrowser-working\extensions\`

---

## ğŸ“ Directory Structure

```
c:\TUYA\
â”œâ”€â”€ nanobrowser/                          âŒ READ-ONLY (Official Source)
â”‚   â”œâ”€â”€ .git/                             
â”‚   â”œâ”€â”€ pages/                            âŒ NEVER EDIT
â”‚   â”œâ”€â”€ packages/                         âŒ NEVER EDIT
â”‚   â””â”€â”€ [All source files]                âŒ UPDATES VIA GIT PULL
â”‚
â””â”€â”€ RankifyAssist\
    â””â”€â”€ nanobrowser-working/              âœ… WORKING DIRECTORY
        â”œâ”€â”€ [Official built files]        âš ï¸  Replaced on update
        â””â”€â”€ extensions/                   âœ… YOUR SAFE ZONE
            â””â”€â”€ tuya-integration/         âœ… MODIFY HERE
                â”œâ”€â”€ tuya-controller.js
                â”œâ”€â”€ tuya-settings.html
                â””â”€â”€ README.md             ğŸ“– READ THIS!
```

---

## âœ… WHAT YOU CAN DO:

1. **Add files to:** `extensions/tuya-integration/`
2. **Modify:** `manifest.json` (in working copy only)
3. **Append to:** `background.iife.js` (in working copy only)
4. **Create:** Standalone HTML/JS/CSS files
5. **Use:** Vanilla JavaScript (no build process)

---

## âŒ WHAT YOU MUST NEVER DO:

1. âŒ Edit `.tsx` or `.ts` files in `nanobrowser/`
2. âŒ Modify `nanobrowser/pages/`
3. âŒ Run `pnpm build` after changing source
4. âŒ Import React components from source
5. âŒ Create dependencies on source structure

---

## ğŸ¯ WHY THIS MATTERS:

**User's Workflow:**
```bash
cd c:\TUYA\nanobrowser
git pull                    # Gets latest Nanobrowser
pnpm build                  # Rebuilds
# ... update script copies to working copy
```

**If you modified source files:**
- `git pull` overwrites your changes âŒ
- Build fails or omits changes âŒ
- User loses custom features âŒ
- Update-proof guarantee broken âŒ

**With proper architecture:**
- `git pull` has zero conflicts âœ…
- Official files update cleanly âœ…
- `extensions/` folder untouched âœ…
- Custom featuresæ°¸ä¹… survive âœ…

---

## ğŸ“– REQUIRED READING:

Before making ANY changes:

1. **Main Architecture:** `UPDATE-PROOF-ARCHITECTURE.md`
2. **Tuya Module Guide:** `nanobrowser-working/extensions/tuya-integration/README.md`
3. **Update Process:** `ARCHITECTURE-COMPLETE.md`

---

## ğŸ”„ TYPICAL USER REQUESTS:

### âœ… CORRECT Response:

**User:** "Add scene automation to Tuya"

**You:**
```
I'll create extensions/tuya-integration/tuya-scenes.js
This keeps the update-proof architecture intact.

[Create file in extensions/]
[Update manifest.json in working copy]
[Test and verify]
```

### âŒ WRONG Response:

**User:** "Add scene automation to Tuya"

**You:**
```
I'll add a new React component to nanobrowser/pages/options/src/

âŒ NO! This breaks update-proof architecture!
```

---

## ğŸ›¡ï¸ VALIDATION CHECKLIST:

After implementing ANY feature:

- [ ] Zero modifications in `c:\TUYA\nanobrowser/`
- [ ] All new files in `extensions/`
- [ ] `git status` in nanobrowser/ shows clean
- [ ] Module loads correctly
- [ ] Update script preserves changes
- [ ] User can run `git pull` safely

**If ANY item fails: YOU DID IT WRONG**

---

## ğŸ“ UNDERSTANDING THE PATTERN:

Think of it like browser extensions:

- **Chrome source code** = `nanobrowser/` (you don't modify Chrome!)
- **Your extension** = `extensions/` (isolated, update-proof)
- **Extension APIs** = `manifest.json`, message passing
- **Result** = Chrome updates don't break your extension

Same concept here!

---

## ğŸ’¡ COMMON SCENARIOS:

### Scenario 1: User wants UI changes

âŒ **Wrong:** Modify `nanobrowser/pages/options/src/Options.tsx`  
âœ… **Right:** Create `extensions/tuya-integration/tuya-settings.html`

### Scenario 2: User wants new background logic

âŒ **Wrong:** Edit `nanobrowser/chrome-extension/src/background.ts`  
âœ… **Right:** Create `extensions/tuya-integration/tuya-feature.js`, append to `background.iife.js`

### Scenario 3: User wants content script

âŒ **Wrong:** Modify `nanobrowser/pages/content/src/index.ts`  
âœ… **Right:** Create `extensions/tuya-integration/tuya-feature.js`, add to `manifest.json`

### Scenario 4: User wants to "update official Nanobrowser"

âŒ **Wrong:** Modify source and rebuild  
âœ… **Right:** Tell user to run:
```powershell
cd c:\TUYA\nanobrowser
git pull
pnpm build
c:\TUYA\RankifyAssist\update-nanobrowser.ps1
```

---

## ğŸš¨ RED FLAGS:

If you find yourself about to:
- Open any `.tsx` file
- Edit anything in `pages/`
- Run `pnpm build` after changes
- Import from `@extension/ui`
- Create React components

**STOP!** You're violating architecture. Re-read this file.

---

## âœ… GREEN FLAGS:

You're doing it right if:
- All new files in `extensions/`
- Using vanilla JS/HTML
- Zero source modifications
- Standalone components
- No build dependencies

---

## ğŸ“ WHEN IN DOUBT:

Ask yourself:
1. "Will `git pull` in nanobrowser/ break this?"
2. "Does this require rebuilding source?"
3. "Am I modifying React/TSX files?"

If YES to any â†’ **WRONG APPROACH**

---

## ğŸ¯ SUCCESS CRITERIA:

You successfully implemented update-proof architecture when:

1. âœ… User can `git pull` official repo without conflicts
2. âœ… Your features survive after update
3. âœ… No source code modifications needed
4. âœ… Module is self-contained in `extensions/`
5. âœ… Update script preserves everything

---

## ğŸ“œ FINAL REMINDER:

**The user chose Nanobrowser specifically because EKO's "eyes were broken".**

**They want:**
- A working browser automation tool âœ…
- That updates regularly âœ…
- With custom Tuya integration âœ…
- That NEVER breaks on updates âœ…

**Your job:** Make that happen. Follow this architecture religiously.

**Failure mode:** User has to manually fix your changes after every Nanobrowser update. **Unacceptable.**

---

**Acknowledgment Required:**

Type to confirm: "I have read and understood the update-proof architecture requirements"

Then proceed with implementation.

---

**Version:** 1.0  
**Created:** 2025-12-17  
**Purpose:** Prevent future AI assistants from breaking architecture  
**Severity:** CRITICAL - Read before ANY code changes
